<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Coffee Menu</title>
<style>
:root{
    --bg:#0f0f0f;
    --panel:#141414;
    --muted:#ccc;
    --accent:#d4a373;
    --accent-2:#ffb347;
    --maxw:1100px;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif}
body{background:var(--bg);color:#fff;min-height:100vh;scroll-behavior:smooth}

/* Header */
.header-wrap{position:fixed;inset:0 0 auto 0;height:72px;background:linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.15));backdrop-filter:blur(6px);border-bottom:1px solid rgba(255,255,255,0.03);z-index:1200}
.header{max-width:var(--maxw);margin:0 auto;height:100%;display:flex;align-items:center;justify-content:space-between;padding:0 24px}
.logo{font-size:20px;color:var(--accent);font-weight:700}
.nav{display:flex;gap:18px;align-items:center}
.nav a{color:#fff;text-decoration:none}
.menu-btn{display:none}

/* layout */
.main{padding:100px 20px 40px}
.container{max-width:var(--maxw);margin:0 auto}
.columns{display:flex;gap:36px;align-items:flex-start}
.left{flex:0 0 420px;min-width:260px}
.right{flex:1}

/* product image & details */
.product-img{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.2));padding:18px;border-radius:14px;display:flex;justify-content:center;align-items:center}
.product-img img{width:195px;max-width:100%;border-radius:12px;display:block;transition:transform .4s}

.info{margin-top:14px}
.info h1{font-size:26px;color:var(--accent);margin-bottom:8px}
.info p{color:var(--muted);margin-bottom:8px}
.price{font-size:22px;color:var(--accent-2);font-weight:700;margin-bottom:14px}

/* product list */
.product-list{display:flex;flex-direction:column;gap:12px}
.product-list h3{cursor:pointer;padding:10px;border-radius:10px;background:#1a1a1a;transition:transform .18s,background .18s}
.product-list h3:hover{transform:translateX(6px);background:linear-gradient(90deg, rgba(212,163,115,0.06), rgba(0,0,0,0.15))}

/* details panel animation */
.details-panel{overflow:hidden;max-height:0;opacity:0;transition:all .45s ease;padding-top:8px}
.details-panel.active{max-height:450px;opacity:1}

/* small buttons */
#moreBtn,#addCartBtn,#paymentBtn,#goCartBtn{margin-top:14px;padding:10px 16px;border-radius:8px;border:none;background:var(--accent);color:#000;font-weight:700;cursor:pointer}
.cancel{margin-left:8px;padding:10px 16px;border-radius:8px;border:1px solid var(--accent);background:transparent;color:var(--accent);cursor:pointer}

/* cart */
.cart-container{margin-top:20px;background:#1a1a1a;padding:16px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.3)}
.cart-container h3{color:var(--accent-2);margin-bottom:12px}
.cart-items{list-style:none;padding-left:0;max-height:200px;overflow-y:auto;margin-bottom:12px}
.cart-items li{padding:8px;border-bottom:1px solid rgba(255,255,255,0.08);display:flex;justify-content:space-between;align-items:center}
.cart-items li:last-child{border-bottom:none}
.remove-btn{padding:4px 8px;background:#ff4d4d;border:none;border-radius:6px;color:#fff;cursor:pointer}

/* payment */
.payment-container{margin-top:16px; display:none;}
.payment-container label{display:block;margin-bottom:6px;cursor:pointer}
.payment-container input[type="radio"]{margin-right:8px}
.payment-interface{display:none;margin-top:12px;padding:16px;border-radius:10px}
.payment-interface input{width:100%;padding:10px;margin-top:8px;border-radius:6px;border:none;font-size:16px}

/* specific colors */
.bkash-interface{background: #ffc0cb; color:#000;}
.nagad-interface{background: #ffa500; color:#000;}
.card-interface{background: linear-gradient(135deg, #ff7e5f, #feb47b); color:#fff;}

/* search/filter */
#searchFilter{margin-bottom:14px;display:flex;gap:8px;flex-wrap:wrap}
#searchInput{flex:1;padding:8px;border-radius:8px;border:none;background:#1a1a1a;color:#fff}
#filterSelect{padding:8px;border-radius:8px;border:none;background:#1a1a1a;color:#fff}

/* reviews */
.review-container{margin-top:20px;background:#1a1a1a;padding:16px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.3)}
.review-container h3{color:var(--accent-2);margin-bottom:12px}
.review-list{list-style:none;padding-left:0;max-height:200px;overflow-y:auto;margin-bottom:12px}
.review-list li{padding:8px;border-bottom:1px solid rgba(255,255,255,0.08)}
.review-list li:last-child{border-bottom:none}
#reviewForm{display:flex;flex-direction:column;gap:8px}
#reviewForm input, #reviewForm textarea{padding:8px;border-radius:6px;border:none;background:#2b2b2b;color:#fff}
#reviewForm button{padding:10px;background:var(--accent);border:none;color:#000;border-radius:8px;font-weight:700;cursor:pointer}

/* responsive */
@media (max-width:1000px){
.columns{flex-direction:column-reverse}
.left{width:100%}
.right{width:100%}
.product-img img{width:320px}
}
@media (max-width:600px){
.product-img img{width:195px}
.product-list h3{font-size:15px;padding:8px}
.info h1{font-size:20px}
}
.popup-bg{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:2200}
.popup-box{width:320px;background:#1a1a1a;padding:20px;border-radius:10px;animation:pop .32s ease both}
@keyframes pop{from{opacity:0;transform:scale(.96)}to{opacity:1;transform:scale(1)}}
</style>
</head>
<body>

<!-- Header -->
<div class="header-wrap">
<header class="header">
  <div class="logo">☕ Coffee Shop</div>
  <nav class="nav" id="nav">
    <a href="index.html#home">Home</a>
    <a href="index.html#about">About</a>
    <a href="index.html#contact">Contact</a>
    <a href="#" id="loginBtn">Login</a>
    <a href="#" id="signupBtn">Sign Up</a>
  </nav>
  <button class="menu-btn" id="menuBtn">☰</button>
</header>
</div>

<main class="main">
  <div class="container columns">

    <!-- ALL coffee content (left + right) wrapped so we can hide everything when showing payment -->
    <div id="coffeeContent" style="width:100%;display:block;">

      <!-- Left panel -->
      <div class="left" style="float:left;">
        <div class="product-img">
          <img id="coffee-img" src="images/cup2-removebg-preview.png" alt="coffee image">
        </div>
        <div class="info">
          <h1 id="details-name">Strawberry Coffee</h1>
          <p id="details-text">Freshly brewed strawberry infused coffee.</p>
          <div class="price" id="details-price">$39.99</div>
          <div>
            <button id="moreBtn">More Details</button>
            <button class="cancel" id="cancelBtn" style="display:none">Close</button>
            <button id="addCartBtn">Add to Cart</button>
            <button id="paymentBtn">Payment</button>
          </div>

          <div class="details-panel" id="detailsPanel">
            <p style="color:var(--muted)">This specialty cup blends fruity notes with smooth espresso for a refreshing seasonal treat.</p>
            <ul style="color:var(--muted);margin-top:10px">
              <li>Single origin beans</li>
              <li>Slow drip infusion</li>
              <li>Topped with cream and strawberry sauce</li>
            </ul>
          </div>

          <div class="cart-container">
            <h3>Cart</h3>
            <ul class="cart-items" id="cartItems"></ul>
            <div>Total: <span id="cartTotal">$0.00</span></div>
          </div>




          <div class="review-container">
            <h3>Reviews</h3>
            <ul class="review-list" id="reviewList"></ul>
            <form id="reviewForm">
              <input type="text" id="reviewName" placeholder="Your Name" required>
              <textarea id="reviewText" placeholder="Your Review" required></textarea>
              <button type="submit">Add Review</button>
            </form>
          </div>
        </div>
      </div>

      <!-- Right panel -->
      <div class="right" style="float:right;">
        <h2 style="color:var(--accent);margin-bottom:12px">Our Selection</h2>
        <div id="searchFilter">
          <input type="text" id="searchInput" placeholder="Search coffee...">
          <select id="filterSelect">
            <option value="all">All</option>
            <option value="iced">Iced</option>
            <option value="hot">Hot</option>
          </select>
        </div>

        <div class="product-list" id="coffeeList">
          <h3 data-coffee="strawberry" data-type="hot" class="active">Strawberry Coffee</h3>
          <h3 data-coffee="green" data-type="hot">Green Tea Coffee</h3>
          <h3 data-coffee="choco" data-type="hot">Chocolate Coffee</h3>
          <h3 data-coffee="caramel_sauce" data-type="hot">Caramel Sauce & Vanilla Cream</h3>
          <h3 data-coffee="mint_cookie" data-type="iced">Iced Mint Cookie Latte</h3>
          <h3 data-coffee="caramel_mocha" data-type="iced">Iced Caramel Mocha</h3>
        </div>
      </div>

    </div> <!-- end coffeeContent -->



<!-- Payment section (hidden by default). When paymentBtn clicked, coffeeContent hides and this shows -->
<div class="payment-container" id="paymentSection">
  <h3 style="color:var(--accent-2);margin-bottom:12px">Payment Method</h3>

  <!-- Coupon Section -->
  <div class="coupon-section" style="margin-bottom:20px;padding:15px;background:#1a1a1a;border-radius:10px;">
    <h4 style="color:var(--accent);margin-bottom:10px;">Apply Coupon</h4>
    <div style="display:flex;gap:10px;align-items:center;">
      <input type="text" id="couponCodeInput" placeholder="Enter coupon code" style="flex:1;padding:8px;border-radius:6px;border:none;background:#2b2b2b;color:#fff;">
      <button id="applyCouponBtn" style="padding:8px 16px;background:var(--accent);color:#000;border:none;border-radius:6px;cursor:pointer;font-weight:bold;">Apply</button>
    </div>
    <div id="couponMessage" style="margin-top:8px;font-size:14px;"></div>
    <div id="couponDetails" style="margin-top:8px;padding:8px;background:rgba(212,163,115,0.1);border-radius:6px;display:none;">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <span id="couponInfo" style="color:var(--accent);font-weight:bold;"></span>
        <button id="removeCouponBtn" style="background:#ff4757;color:white;border:none;padding:4px 8px;border-radius:4px;cursor:pointer;font-size:12px;">Remove</button>
      </div>
    </div>
  </div>

  <!-- Order Summary -->
  <div class="order-summary" style="margin-bottom:20px;padding:15px;background:#1a1a1a;border-radius:10px;">
    <h4 style="color:var(--accent);margin-bottom:10px;">Order Summary</h4>
    <div style="display:flex;justify-content:space-between;margin-bottom:5px;">
      <span>Subtotal:</span>
      <span id="orderSubtotal">$0.00</span>
    </div>
    <div style="display:flex;justify-content:space-between;margin-bottom:5px;color:var(--accent);" id="discountRow" style="display:none;">
      <span>Discount:</span>
      <span id="orderDiscount">-$0.00</span>
    </div>
    <div style="display:flex;justify-content:space-between;font-weight:bold;border-top:1px solid rgba(255,255,255,0.1);padding-top:8px;">
      <span>Total:</span>
      <span id="orderTotal">$0.00</span>
    </div>
  </div>

  <form id="paymentForm">
    <label><input type="radio" name="payment" value="bkash" required> Bkash</label>
    <label><input type="radio" name="payment" value="nagad" required> Nagad</label>
    <label><input type="radio" name="payment" value="card" required> Card</label>

    <div id="bkashInterface" class="payment-interface bkash-interface">
      <div style="display:flex;align-items:center;gap:10px;flex-direction:column;">
        <img src="images/bkash.png" alt="Bkash" style="width:60px;margin-bottom:10px">
        <label>Bkash Number</label>
        <input type="text" placeholder="01XXXXXXXXX" required>
        <button type="button" id="bkashPayBtn">Pay with Bkash</button>
      </div>
    </div>

    <div id="nagadInterface" class="payment-interface nagad-interface">
      <div style="display:flex;align-items:center;gap:10px;flex-direction:column;">
        <img src="images/nagad.jpg" alt="Nagad" style="width:60px;margin-bottom:10px">
        <label>Nagad Number</label>
        <input type="text" placeholder="01XXXXXXXXX" required>
        <button type="button" id="nagadPayBtn">Pay with Nagad</button>
      </div>
    </div>

    <div id="cardInterface" class="payment-interface card-interface">
      <div style="display:flex;flex-direction:column;gap:8px;">
        <label>Card Number</label>
        <input type="text" placeholder="XXXX XXXX XXXX XXXX" required style="color:#000">
        <label>Card Holder Name</label>
        <input type="text" placeholder="Full Name" required style="color:#000">
        <div style="display:flex;gap:8px;">
          <div style="flex:1">
            <label>Expiry</label>
            <input type="text" placeholder="MM/YY" required style="color:#000">
          </div>
          <div style="flex:1">
            <label>CVV</label>
            <input type="text" placeholder="XXX" required style="color:#000">
          </div>
        </div>
        <button type="submit" id="cardPayBtn">Pay with Card</button>
      </div>
    </div>

    <div style="margin-top:12px;">
      <button type="button" id="goCartBtn" style="padding:10px 16px;border-radius:8px;border:none;background:#555;color:#fff;cursor:pointer;">Go to Cart</button>
    </div>
  </form>
</div>

    <div style="margin-top:12px;">
      <button type="button" id="goCartBtn" style="padding:10px 16px;border-radius:8px;border:none;background:#555;color:#fff;cursor:pointer;">Go to Cart</button>
    </div>
  </form>
</div>
</main>

<!-- LOGIN POPUPS -->
<div class="popup-bg" id="loginPopup">
  <div class="popup-box">
    <h3>Login</h3>
    <input type="email" placeholder="Email">
    <input type="password" placeholder="Password">
    <button style="width:100%;padding:10px;margin-top:8px;background:var(--accent);color:#000;border:none;border-radius:8px;">Login</button>
    <div style="text-align:center;margin-top:8px;color:var(--muted);cursor:pointer" onclick="closePopups()">Close</div>
  </div>
</div>
<div class="popup-bg" id="signupPopup">
  <div class="popup-box">
    <h3>Sign Up</h3>
    <input type="text" placeholder="Full Name">
    <input type="email" placeholder="Email">
    <input type="password" placeholder="Password">
    <button style="width:100%;padding:10px;margin-top:8px;background:var(--accent);color:#000;border:none;border-radius:8px;">Sign Up</button>
    <div style="text-align:center;margin-top:8px;color:var(--muted);cursor:pointer" onclick="closePopups()">Close</div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const API_BASE = 'http://localhost:5000/api';

  // Product list will be loaded from backend
  let products = [];
  const productsById = {};

  async function loadProductsFromApi(){
    try{
      const res = await fetch(API_BASE + '/products');
      if(!res.ok) throw new Error('Failed to load products');
      products = await res.json();
      products.forEach(p => productsById[p._id] = p);
      renderProductList();
      // select first product if none selected
      const first = products[0];
      if(first){ selectProductById(first._id); }
    }catch(err){
      console.warn('Could not load products from API, using fallback data', err);
      // Fallback data with all 6 products
      products = [
        {
          _id: '1',
          name: 'Strawberry Coffee',
          price: 39.99,
          category: 'hot',
          description: 'Freshly brewed strawberry infused coffee.',
          image: 'images/cup2-removebg-preview.png'
        },
        {
          _id: '2', 
          name: 'Green Tea Coffee',
          price: 29.99,
          category: 'hot',
          description: 'Smooth matcha green tea latte.',
          image: 'images/cup3-removebg-preview.png'
        },
        {
          _id: '3',
          name: 'Chocolate Coffee',
          price: 34.99,
          category: 'hot',
          description: 'Velvety cocoa blended coffee.',
          image: 'images/cup4-removebg-preview.png'
        },
        {
          _id: '4',
          name: 'Caramel Sauce & Vanilla Cream',
          price: 42.99,
          category: 'hot',
          description: 'Rich caramel sauce with smooth vanilla cream.',
          image: 'images/caramel-sauce-and-vanilla-cream.png'
        },
        {
          _id: '5',
          name: 'Iced Mint Cookie Latte',
          price: 36.99,
          category: 'iced',
          description: 'Refreshing iced mint cookie latte.',
          image: 'images/icedmintcookielatte.png'
        },
        {
          _id: '6',
          name: 'Iced Caramel Mocha',
          price: 44.99,
          category: 'iced',
          description: 'Chilled caramel mocha delight.',
          image: 'images/iced-caramel-mocha.png'
        }
      ];
      products.forEach(p => productsById[p._id] = p);
      renderProductList();
      const first = products[0]; 
      if(first) selectProductById(first._id);
    }
  }

  // Elements
  const coffeeListContainer = document.getElementById('coffeeList');
  const coffeeImg = document.getElementById('coffee-img');
  const detailsPanel = document.getElementById('detailsPanel');
  const detailsName = document.getElementById('details-name');
  const detailsText = document.getElementById('details-text');
  const detailsPrice = document.getElementById('details-price');
  const moreBtn = document.getElementById('moreBtn');
  const cancelBtn = document.getElementById('cancelBtn');
  const addCartBtn = document.getElementById('addCartBtn');
  const paymentBtn = document.getElementById('paymentBtn');
  const coffeeContent = document.getElementById('coffeeContent');
  const paymentSection = document.getElementById('paymentSection');
  const goCartBtn = document.getElementById('goCartBtn');

  const cartItemsEl = document.getElementById('cartItems');
  const cartTotalEl = document.getElementById('cartTotal');

  let cart = [];

  // Reviews
  const reviewList = document.getElementById('reviewList');
  const reviewForm = document.getElementById('reviewForm');
  const reviewName = document.getElementById('reviewName');
  const reviewText = document.getElementById('reviewText');
  let reviews = [];

  // Payment interfaces
  const paymentForm = document.getElementById('paymentForm');
  const bkashInterface = document.getElementById('bkashInterface');
  const nagadInterface = document.getElementById('nagadInterface');
  const cardInterface = document.getElementById('cardInterface');
  const bkashPayBtn = document.getElementById('bkashPayBtn');
  const nagadPayBtn = document.getElementById('nagadPayBtn');

  // Initialize coffee list click behavior
  function renderProductList(){
    if(!coffeeListContainer) return;
    coffeeListContainer.innerHTML = '';
    products.forEach(p => {
      const h = document.createElement('h3');
      h.dataset.id = p._id;
      h.dataset.type = p.category || 'coffee';
      h.textContent = p.name;
      h.addEventListener('click', () => selectProductById(p._id));
      coffeeListContainer.appendChild(h);
    });
  }

  function selectProductById(id){
    const p = productsById[id];
    if(!p) return;
    // remove active class
    document.querySelectorAll('#coffeeList h3').forEach(x=>x.classList.remove('active'));
    const sel = document.querySelector(`#coffeeList h3[data-id='${id}']`);
    if(sel) sel.classList.add('active');
    coffeeImg.src = p.image || 'images/cup2-removebg-preview.png';
    detailsName.textContent = p.name;
    detailsText.textContent = p.description || '';
    detailsPrice.textContent = '$' + (parseFloat(p.price)||0).toFixed(2);
    coffeeImg.dataset.selectedId = id;
  }

  // Details toggle
  moreBtn.addEventListener('click', () => {
    detailsPanel.classList.add('active');
    moreBtn.style.display = 'none';
    cancelBtn.style.display = 'inline-block';
  });
  cancelBtn.addEventListener('click', () => {
    detailsPanel.classList.remove('active');
    moreBtn.style.display = 'inline-block';
    cancelBtn.style.display = 'none';
  });

  // Cart functions
  function renderCart(){
    cartItemsEl.innerHTML = '';
    let total = 0;
    cart.forEach((item, i) => {
      total += parseFloat(item.price);
      const li = document.createElement('li');
      li.innerHTML = `${item.name} - $${item.price} <button class="remove-btn" onclick="removeCartItem(${i})">Remove</button>`;
      cartItemsEl.appendChild(li);
    });
    cartTotalEl.textContent = '$' + total.toFixed(2);
  }
  
  // expose remove function globally for inline onclick to work
  window.removeCartItem = function(i){
    cart.splice(i,1);
    renderCart();
  };

  addCartBtn.addEventListener('click', () => {
    const selected = coffeeImg.dataset.selectedId;
    if(!selected){ alert('Select a product first'); return; }
    const p = productsById[selected];
    if(!p) { alert('Product not found'); return; }
    const item = { productId: p._id, name: p.name, price: parseFloat(p.price)||0, qty: 1 };
    cart.push(item);
    renderCart();
  });

  // Reviews
  reviewForm.addEventListener('submit', e => {
    e.preventDefault();
    const name = reviewName.value.trim();
    const text = reviewText.value.trim();
    if(name && text){
      reviews.push({name, text});
      renderReviews();
      reviewForm.reset();
    }
  });
  
  function renderReviews(){
    reviewList.innerHTML = '';
    reviews.forEach(r => {
      const li = document.createElement('li');
      li.textContent = `${r.name}: ${r.text}`;
      reviewList.appendChild(li);
    });
  }

  // Payment visibility logic
  paymentBtn.addEventListener('click', () => {
    coffeeContent.style.display = 'none';
    paymentSection.style.display = 'block';
    bkashInterface.style.display = 'none';
    nagadInterface.style.display = 'none';
    cardInterface.style.display = 'none';
    paymentForm.querySelectorAll('input[name="payment"]').forEach(r => r.checked = false);
  });

  // Go back to cart view
  goCartBtn.addEventListener('click', () => {
    paymentSection.style.display = 'none';
    coffeeContent.style.display = 'block';
  });

  // Payment method radio change
  paymentForm.querySelectorAll('input[name="payment"]').forEach(radio => {
    radio.addEventListener('change', () => {
      bkashInterface.style.display = 'none';
      nagadInterface.style.display = 'none';
      cardInterface.style.display = 'none';
      if(radio.value === 'bkash') bkashInterface.style.display = 'block';
      if(radio.value === 'nagad') nagadInterface.style.display = 'block';
      if(radio.value === 'card') cardInterface.style.display = 'block';
    });
  });

  // Card payment submit
  paymentForm.addEventListener('submit', e => {
    e.preventDefault();
    const sel = paymentForm.querySelector('input[name="payment"]:checked');
    if(!sel) { alert('Select a payment method'); return; }
    if(sel.value === 'card'){
      const inputs = cardInterface.querySelectorAll('input');
      for(let input of inputs){
        if(!input.value.trim()){ alert('Fill all card fields!'); return; }
      }
      const total = cart.reduce((s,i)=>s+parseFloat(i.price),0).toFixed(2);

      const custName = prompt('Enter your name for the order (optional):','');
      const custEmail = prompt('Enter your email for the order (optional):','');

      const order = {
        items: cart.map(i=>({ name: i.name, price: parseFloat(i.price), qty: 1 })),
        total: parseFloat(total),
        customer: { name: custName || 'Guest', email: custEmail || '' },
        paymentMethod: 'card',
        paymentRef: inputs[0].value.replace(/\s+/g,'')
      };

      (async ()=>{
        try{
          const res = await fetch(API_BASE + '/orders', { 
            method: 'POST', 
            headers: { 'Content-Type': 'application/json' }, 
            body: JSON.stringify(order) 
          });
          const data = await res.json().catch(()=>null);
          if(!res.ok) throw new Error((data && (data.error||data.message)) || `Server error ${res.status}`);
          alert(`Payment of $${total} via Card successful!\nCard Holder: ${inputs[1].value}`);
          cart = []; 
          renderCart();
          paymentForm.reset();
          cardInterface.style.display = 'none';
          paymentSection.style.display = 'none';
          coffeeContent.style.display = 'block';
        }catch(err){
          console.error('Order save failed', err);
          alert('Payment succeeded but saving order failed: ' + (err && err.message ? err.message : err));
        }
      })();
    }
  });

  // Bkash / Nagad handlers
  bkashPayBtn.addEventListener('click', () => {
    const input = bkashInterface.querySelector('input').value.trim();
    if(!input){ alert('Enter your Bkash number!'); return; }
    const total = cart.reduce((s,i)=>s+parseFloat(i.price),0).toFixed(2);

    const custName = prompt('Enter your name for the order (optional):','');
    const custEmail = prompt('Enter your email for the order (optional):','');

    const order = {
      items: cart.map(i=>({ name: i.name, price: parseFloat(i.price), qty: 1 })),
      total: parseFloat(total),
      customer: { name: custName || 'Guest', email: custEmail || '' },
      paymentMethod: 'bkash',
      paymentRef: input
    };

    (async ()=>{
      try{
        const res = await fetch(API_BASE + '/orders', { 
          method: 'POST', 
          headers: { 'Content-Type': 'application/json' }, 
          body: JSON.stringify(order) 
        });
        const data = await res.json().catch(()=>null);
        if(!res.ok) throw new Error((data && (data.error||data.message)) || `Server error ${res.status}`);
        alert(`Payment of $${total} via Bkash successful!\nNumber: ${input}`);
        cart = []; 
        renderCart();
        bkashInterface.querySelector('input').value = '';
        bkashInterface.style.display = 'none';
        paymentSection.style.display = 'none';
        coffeeContent.style.display = 'block';
      }catch(err){
        console.error('Order save failed', err);
        alert('Payment succeeded but saving order failed: ' + (err && err.message ? err.message : err));
      }
    })();
  });

  nagadPayBtn.addEventListener('click', () => {
    const input = nagadInterface.querySelector('input').value.trim();
    if(!input){ alert('Enter your Nagad number!'); return; }
    const total = cart.reduce((s,i)=>s+parseFloat(i.price),0).toFixed(2);

    const custName = prompt('Enter your name for the order (optional):','');
    const custEmail = prompt('Enter your email for the order (optional):','');

    const order = {
      items: cart.map(i=>({ name: i.name, price: parseFloat(i.price), qty: 1 })),
      total: parseFloat(total),
      customer: { name: custName || 'Guest', email: custEmail || '' },
      paymentMethod: 'nagad',
      paymentRef: input
    };

    (async ()=>{
      try{
        const res = await fetch(API_BASE + '/orders', { 
          method: 'POST', 
          headers: { 'Content-Type': 'application/json' }, 
          body: JSON.stringify(order) 
        });
        const data = await res.json().catch(()=>null);
        if(!res.ok) throw new Error((data && (data.error||data.message)) || `Server error ${res.status}`);
        alert(`Payment of $${total} via Nagad successful!\nNumber: ${input}`);
        cart = []; 
        renderCart();
        nagadInterface.querySelector('input').value = '';
        nagadInterface.style.display = 'none';
        paymentSection.style.display = 'none';
        coffeeContent.style.display = 'block';
      }catch(err){
        console.error('Order save failed', err);
        alert('Payment succeeded but saving order failed: ' + (err && err.message ? err.message : err));
      }
    })();
  });

  // Mobile menu
  const menuBtn = document.getElementById('menuBtn');
  const nav = document.getElementById('nav');
  if(menuBtn){ menuBtn.addEventListener('click', ()=> nav.classList.toggle('show')); }

  // Login/Signup popups
  const loginBtn = document.getElementById('loginBtn');
  const signupBtn = document.getElementById('signupBtn');
  const loginPopup = document.getElementById('loginPopup');
  const signupPopup = document.getElementById('signupPopup');
  if(loginBtn) loginBtn.addEventListener('click', (e) => { e.preventDefault(); loginPopup.style.display = 'flex'; });
  if(signupBtn) signupBtn.addEventListener('click', (e) => { e.preventDefault(); signupPopup.style.display = 'flex'; });
  window.closePopups = function(){ 
    if(loginPopup) loginPopup.style.display='none'; 
    if(signupPopup) signupPopup.style.display='none'; 
  };

  // Search & Filter
  const searchInput = document.getElementById('searchInput');
  const filterSelect = document.getElementById('filterSelect');
  function filterCoffees(){
    const search = searchInput.value.toLowerCase();
    const filter = filterSelect.value;
    document.querySelectorAll('#coffeeList h3').forEach(item=>{
      const name = (item.textContent || '').toLowerCase();
      const type = item.dataset.type || '';
      let show = name.includes(search);
      if(filter !== 'all') show = show && type === filter;
      item.style.display = show ? 'block' : 'none';
    });
  }
  searchInput.addEventListener('input', filterCoffees);
  filterSelect.addEventListener('change', filterCoffees);

  // initial render
  renderCart();
  // load products from API
  loadProductsFromApi();
});
</script>

</body>
</html>